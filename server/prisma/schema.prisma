generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                                                         String                @id @default(uuid())
  name                                                       String
  email                                                      String                @unique
  password                                                   String
  role                                                       Role                  @default(STUDENT)
  profilePic                                                 String?
  verificationStatus                                         VerificationStatus    @default(PENDING)
  refreshToken                                               String?
  notificationToken                                          String?
  createdAt                                                  DateTime              @default(now())
  updatedAt                                                  DateTime              @updatedAt
  Hod                                                        Hod?
  uploadedNotes                                              Note[]                @relation("UploadedNotes")
  Professor                                                  Professor?
  Student                                                    Student?
  VerificationRequest_VerificationRequest_approvedByIdToUser VerificationRequest[] @relation("VerificationRequest_approvedByIdToUser")
  VerificationRequest_VerificationRequest_userIdToUser       VerificationRequest[] @relation("VerificationRequest_userIdToUser")
}

model Department {
  id        String      @id @default(uuid())
  name      String      @unique
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  divisions Division[]
  Hod       Hod?
  Professor Professor[]
  semesters Semester[]
  Student   Student[]
  subjects  Subject[]
}

model Division {
  id                        String                      @id @default(uuid())
  name                      String
  semesterId                String
  departmentId              String
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  department                Department                  @relation(fields: [departmentId], references: [id])
  Semester                  Semester                    @relation(fields: [semesterId], references: [id])
  DivisionSubjectAssignment DivisionSubjectAssignment[]
  Student                   Student[]

  @@unique([name, semesterId, departmentId])
}

model Semester {
  id           String     @id @default(uuid())
  number       Int
  departmentId String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  Division     Division[]
  department   Department @relation(fields: [departmentId], references: [id])
  Student      Student[]
  subjects     Subject[]

  @@unique([departmentId, number])
}

model Subject {
  id                        String                      @id @default(uuid())
  name                      String
  description               String?
  semesterId                String
  departmentId              String
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  code                      String
  DivisionSubjectAssignment DivisionSubjectAssignment[]
  StudentSubject            StudentSubject[]
  department                Department                  @relation(fields: [departmentId], references: [id])
  semester                  Semester                    @relation(fields: [semesterId], references: [id])

  @@unique([name, semesterId, departmentId])
}

model Note {
  id           String   @id @default(uuid())
  title        String
  description  String?
  fileUrl      String
  downloadUrl  String
  notetyoe     NoteType
  uploadedById String
  isPublic     Boolean  @default(true)
  isOfficial   Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  uploadedBy   User     @relation("UploadedNotes", fields: [uploadedById], references: [id])
}

model DivisionSubjectAssignment {
  id          String     @id @default(uuid())
  divisionId  String
  subjectId   String
  professorId String?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  Division    Division   @relation(fields: [divisionId], references: [id])
  Professor   Professor? @relation(fields: [professorId], references: [id])
  Subject     Subject    @relation(fields: [subjectId], references: [id])

  @@unique([divisionId, subjectId])
  @@index([professorId])
}

model Hod {
  id           String     @id @default(uuid())
  userId       String     @unique
  departmentId String     @unique
  Department   Department @relation(fields: [departmentId], references: [id])
  User         User       @relation(fields: [userId], references: [id])
}

model Professor {
  id                        String                      @id @default(uuid())
  userId                    String                      @unique
  teacherId                 String                      @unique
  departmentId              String?
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime                    @updatedAt
  DivisionSubjectAssignment DivisionSubjectAssignment[]
  Department                Department?                 @relation(fields: [departmentId], references: [id])
  User                      User                        @relation(fields: [userId], references: [id])
}

model Student {
  id             String           @id @default(uuid())
  userId         String           @unique
  enrollmentNo   String           @unique
  savedNotes     String[]         @default([])
  departmentId   String
  divisionId     String?
  semesterId     String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  Department     Department       @relation(fields: [departmentId], references: [id])
  Division       Division?        @relation(fields: [divisionId], references: [id])
  Semester       Semester?        @relation(fields: [semesterId], references: [id])
  User           User             @relation(fields: [userId], references: [id])
  StudentSubject StudentSubject[]
}

model StudentSubject {
  id         String           @id @default(uuid())
  studentId  String
  subjectId  String
  status     EnrollmentStatus @default(ACTIVE)
  enrolledAt DateTime         @default(now())
  Student    Student          @relation(fields: [studentId], references: [id])
  Subject    Subject          @relation(fields: [subjectId], references: [id])

  @@unique([studentId, subjectId])
  @@index([subjectId])
}

model VerificationRequest {
  id                                          String             @id @default(uuid())
  userId                                      String
  approvedById                                String?
  type                                        VerificationType
  status                                      VerificationStatus @default(PENDING)
  reason                                      String?
  updatedData                                 Json?
  createdAt                                   DateTime           @default(now())
  updatedAt                                   DateTime           @updatedAt
  User_VerificationRequest_approvedByIdToUser User?              @relation("VerificationRequest_approvedByIdToUser", fields: [approvedById], references: [id])
  User_VerificationRequest_userIdToUser       User               @relation("VerificationRequest_userIdToUser", fields: [userId], references: [id])
}

enum Role {
  STUDENT
  PROFESSOR
  HOD
}

enum NoteType {
  NOTES
  PYQ
  QN_BANK
  ASSIGNMENT
  MANUAL
  PPT
  PDF
  OTHER
}

enum EnrollmentStatus {
  ACTIVE
  DROPPED
  COMPLETED
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum VerificationType {
  REGISTRATION
  PROFILE_UPDATE
}
